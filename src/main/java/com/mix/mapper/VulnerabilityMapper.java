package com.mix.mapper;

import com.alibaba.fastjson.JSONObject;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.mix.entity.dto.Vulnerability;
import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;

import java.util.List;

@Mapper
public interface VulnerabilityMapper extends BaseMapper<Vulnerability> {

    // 列表查询
    @Select("SELECT contract_name, contract_address, vulnerability_type, contract_describe " +
            "FROM public.vulnerability")
    List<Vulnerability> queryVulnerabilityList();


    // 根据 contract_address 查询基本信息
    @Select("SELECT contract_name, contract_address, vulnerability_type, contract_describe " +
            "FROM public.vulnerability WHERE contract_address = #{contractAddress}")
    Vulnerability queryVulnerabilityBaseInfo(@Param("contractAddress") String contractAddress);

    // 根据 contract_address 查询详细信息
    @Select("SELECT source_code, source_code_tree, source_code_scan_result " +
            "FROM public.vulnerability WHERE contract_address = #{contractAddress}")
    Vulnerability queryVulnerabilityDetails(@Param("contractAddress") String contractAddress);

    @Select("SELECT attack_step " +
            "FROM public.vulnerability WHERE contract_address = #{contractAddress}")
    String queryAttackStep(@Param("contractAddress") String contractAddress);

}
